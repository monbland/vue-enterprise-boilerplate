# Библотека vuex-orm

- [Базовая модель](#базовая-модель)
- [Основные методы модели](#основные-методы-модели)
- [Создание новой модели](#создание-новой-модели)
- [Пустая новая модель](#пустая-новая-модель)
- [Использование в компонентах](#использование-в-компонентах)
- [Основные используемые методы vuex-orm](#основные-используемые-методы-vuex-orm)
- [Дополнительная информация](#дополнительная-информация)
- [Ссылки](#ссылки)

## Базовая модель

В проекте используется билиотека Vuex-ORM в рамках которой сделана базовая модель и прописаны методы для нее.

Базовая модель находится в файле

`/src/models/BaseModel.js`

## Основные методы модели

`.fetch(parent)`

Метод отправляет get запрос по объявленной в модели корневой ссылке. Из полученнго объекта информация пишется в нужный подмодуль vuex хранилища.

`parent` Передаваемый параметр типа Boolean - при значении true, запускается `.fetch` всех связанных модулей.

Сделано для подгрузки актуальной релевантной информации связанных с объектом сущностей.

`.createRecord(object)`

Метод отправляет post запрос по объявленной в модели корневой ссылке. При успехе, записывает в vuex-orm созданный объект. При неудаче возвращает ответ сервера, для обработки ошибок.

`object` Создаваемый объект.

`.update(object)`

Метод отправляет put запрос по объявленной в модели корневой ссылке, добавляя id объекта. При успехе, записывает в vuex-orm обновленный объект. При неудаче возвращает ответ сервера, для обработки ошибок.

`object` Редактируемый объект.

`.delete(object)`

Метод отправляет delete запрос по объявленной в модели корневой ссылке, добавляя id объекта. Так же удаляет из vuex-orm удаленный объект.

`object` Удаляемый объект.

## Создание новой модели

Сделан генератор для новых моделей. Он доступен по команде:

`yarn new model`

Генератор создает пустую модель унаследованную от базовой. Для ввода модели в работу необходимо провести ряд операций.

- Записать экспорт модели в файл `/src/models/Hierarchy.js` Пример - `export * from '@models/Phones'`

- Записать модель в поле types базовой модели. Для этого надо импортировать модель из `/src/models/Hierarchy.js` . Затем в поле types записывается строка вида `PHONES: Phones,` с названием модели апперкейзом и импортированной моделью.

- Зарегистрировать модель в базе. Для этого надо импортировать модель из `/src/models/Hierarchy.js` в файл базы данных расположенный в `/src/database/index.js` . Затем необходимо записать в этот же файл строку типа `database.register(Phones)`

```bash
Note: возможна ошибка circular imports.
Экспорт через файл Hierarchy.js сделан для исправления.
Если появляется ошибка, нужно проверить очередность импортов.
```

[Ссылка в помощь в борьбе с circular imports](https://vuex-orm.org/guide/model/single-table-inheritance.html#notes-on-circular-imports)

## Пустая новая модель

В новой модели нас интересуют в первую очередь поля `url` и `fields`

`url`

Возвращаемое значение - корневой url для операций с моделью. Формируется с помощью ключей кабинета/проекта/рабочего места и т. д.

`fields`

Поля модели.

Задаются в виде

`имя поля: тип(стандартное значение или связанная модель и ключ)`

Доступны разные встроенные в vuex-orm типы полей. Основные используемые нами:

`this.number(null)`

Числовое поле

`this.string('')`

Строковое поле.

`this.hasOne(Model, 'id')`

Связь к одному объекту другой модели.

`this.hasMany(Model, 'id')`

Связь к нескольким объекта другой модели.

[Документация по типам филдов](https://vuex-orm.org/guide/model/defining-models.html#fields)

[Документация по типам связей](https://vuex-orm.org/guide/model/relationships.html#customizing-the-pivot-attribute-name)

## Использование в компонентах

В компонент импортируется необходимая модель из Hierarchy.js

В `data()` компонента прописывается параметр

`model: импортированная модель`

В миксин, используемый на большинстве страниц, в `mounted()` прописана команда `this.model.fetch(true)` . Она подтягивает актуальные данные с бэка, а так же данные связанных сущностей.

Далее для работы с данными достаточно получить данные из модели

```js
computed: {
    data() {
      return Model.all()
    }
}
```

## Основные используемые методы vuex-orm

`Model.all()`

Получение всех записей в модели.

`Model.find(id)`

## Дополнительная информация

Для удобства импорта в алиасы проекта добавлены записи

`@models/`

Путь к моделям.

`@database/`

Путь к файлу базы данных

## Ссылки

[Документация vuex-orm](https://vuex-orm.org/) [Документация vuex-orm-axios](https://vuex-orm.github.io/plugin-axios/)
